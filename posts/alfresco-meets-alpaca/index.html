<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Alfraca: Alfresco Meets Alpaca.js - Hakuna Automata</title>
  <meta name="description" content=" Alpaca.js is a client-side forms and templating engine that will build some pretty sweet looking forms using nothing but a bit of JSON and JavaScript, complete with data validation and layout control. I extended Alfresco using this library to enable users to create and edit structured content stored in the repository, such as XML and JSON.
And thus, alfraca was born!"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Hakuna Automata",
    
    "url": "https:\/\/hakuna-automata.com\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/hakuna-automata.com\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/hakuna-automata.com\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/hakuna-automata.com\/posts\/alfresco-meets-alpaca\/",
          "name": "Alfraca alfresco meets alpaca.js"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "Alfraca: Alfresco Meets Alpaca.js",
  "description" : "Alpaca.js is a client-side forms and templating engine that will build some pretty sweet looking forms using nothing but a bit of JSON and JavaScript, complete with data validation and layout control. I extended Alfresco using this library to enable users to create and edit structured content stored in the repository, such as XML and JSON.\nAnd thus, alfraca was born!\n",
  "inLanguage" : "en",
  "wordCount":  1316 ,
  "datePublished" : "2012-07-03T06:03:56",
  "dateModified" : "2012-07-03T06:03:56",
  "image" : "https:\/\/hakuna-automata.com\/",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/hakuna-automata.com\/posts\/alfresco-meets-alpaca\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/hakuna-automata.com\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/hakuna-automata.com\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Alfraca: Alfresco Meets Alpaca.js" />
<meta property="og:description" content=" Alpaca.js is a client-side forms and templating engine that will build some pretty sweet looking forms using nothing but a bit of JSON and JavaScript, complete with data validation and layout control. I extended Alfresco using this library to enable users to create and edit structured content stored in the repository, such as XML and JSON.
And thus, alfraca was born!">
<meta property="og:url" content="https://hakuna-automata.com/posts/alfresco-meets-alpaca/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Hakuna Automata" />

  <meta name="twitter:title" content="Alfraca: Alfresco Meets Alpaca.js" />
  <meta name="twitter:description" content=" Alpaca.js is a client-side forms and templating engine that will build some pretty sweet looking forms using nothing but a bit of JSON and JavaScript, complete with data validation and layout â€¦">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.72.0" />
  <link rel="alternate" href="https://hakuna-automata.com/index.xml" type="application/rss+xml" title="Hakuna Automata"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://hakuna-automata.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://hakuna-automata.com/css/syntax.css" /><link rel="stylesheet" href="https://hakuna-automata.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://hakuna-automata.com/">Hakuna Automata</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Github" href="https://github.com/cmpaul/">Github</a>
            </li>
          
        
          
            <li>
              <a title="LinkedIn" href="https://www.linkedin.com/in/cmpaul/">LinkedIn</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>Alfraca: Alfresco Meets Alpaca.js</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p><img src="/images/alfraca.png?display=inline-block" alt=""> <a href="https://github.com/gitana/alpaca">Alpaca.js</a> is a client-side forms and templating engine that will build some pretty sweet looking forms using nothing but a bit of JSON and JavaScript, complete with data validation and layout control. I extended <a href="https://www.alfresco.com">Alfresco</a> using this library to enable users to create and edit structured content stored in the repository, such as XML and JSON.</p>
<p>And thus, <a href="https://github.com/cmpaul/alfraca">alfraca</a> was born!</p>
<p>Yesterday, I joined Jeff Potts, Dave Draper and Luis Sala at the first ever Alfresco meetup on Google+ to discuss this work which Tribloom has done for a customer.</p>
<p>This client was storing XML files in Alfresco. Their users wanted an easy way to create and modify these files without having to download the file, update it, and re-upload it to Alfresco so we decided to provide them with a dynamic forms engine that could display this content directly from the Share document library.</p>
<p>Alpaca, created by <a href="https://www.cloudcms.com">CloudCMS</a>, is easy to use and configure and I&rsquo;ll outline the modifications we made to Alfresco to make it the Alpaca forms accessible from Share. The relevant code has been extracted into <a href="https://github.com/cmpaul/alfraca">a GitHub repository</a> and can be used to follow along with this post.</p>
<p>In the repository are two Eclipse projects &ndash; one for Alfresco and one for Share &ndash; that can be built and deployed using the included Ant scripts. The example I use in this post also expects the sample &ldquo;moxie.json&rdquo; file to be uploaded to the document library. Once everything is deployed, the integrated form will display the moxie.json content like this:</p>
<p><img src="/images/alfraca-screenshot.png" alt="Screenshot of an Alpaca form in Alfresco"></p>
<p>We extended Share in three key areas. First, we created a custom page that renders the necessary script, CSS, and DOM tags that Alpaca uses to display the form. Next, we configured a custom action that allows the user to access this page and made that action available only when viewing specific kinds of content. Finally, we built webscripts to send and receive the necessary JSON, reading it from and writing it to the repository.</p>
<p>The custom page is what ties Alpaca and Alfresco together. This page is defined in three pieces:</p>
<h2 id="1-page-description">1. Page description</h2>
<p><code>config/web-extension/site-data/pages/edit-alpaca.xml</code></p>
<p>This file describes the custom page and directs Alfresco to a Surf component template, named in the <code>&lt;template-instance&gt;</code> tag.</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="nt">&lt;page&gt;</span>
  <span class="nt">&lt;title&gt;</span>Edit JSON with Alpaca<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;title-id&gt;</span>page.editMetadata.title<span class="nt">&lt;/title-id&gt;</span>
  <span class="nt">&lt;description&gt;</span>Edit a JSON node with Alpaca forms<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;description-id&gt;</span>page.editMetadata.description<span class="nt">&lt;/description-id&gt;</span>
  <span class="nt">&lt;template-instance&gt;</span>edit-alpaca<span class="nt">&lt;/template-instance&gt;</span>
  <span class="nt">&lt;authentication&gt;</span>user<span class="nt">&lt;/authentication&gt;</span>
<span class="nt">&lt;/page&gt;</span>
</code></pre></div><h2 id="2-template-description">2. Template description</h2>
<p><code>config/web-extension/site-data/template-instances/edit-alpaca.xml</code></p>
<p>This page lays out the Surf components that comprise the custom page.</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="nt">&lt;template-instance&gt;</span>
  <span class="nt">&lt;template-type&gt;</span>org/alfresco/edit-alpaca<span class="nt">&lt;/template-type&gt;</span>
  <span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;pageFamily&gt;</span>documentlibrary<span class="nt">&lt;/pageFamily&gt;</span>
    <span class="nt">&lt;container&gt;</span>documentLibrary<span class="nt">&lt;/container&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>
  <span class="nt">&lt;components&gt;</span>
...
    <span class="c">&lt;!-- Edit Metadata Form --&gt;</span>
    <span class="nt">&lt;component&gt;</span>
     <span class="nt">&lt;region-id&gt;</span>edit-alpaca<span class="nt">&lt;/region-id&gt;</span>
     <span class="nt">&lt;url&gt;</span>/components/alpaca-form<span class="nt">&lt;/url&gt;</span>
     <span class="nt">&lt;properties&gt;</span>
     <span class="nt">&lt;itemKind&gt;</span>node<span class="nt">&lt;/itemKind&gt;</span>
     <span class="nt">&lt;itemId&gt;</span>{nodeRef}<span class="nt">&lt;/itemId&gt;</span>
     <span class="nt">&lt;mode&gt;</span>edit<span class="nt">&lt;/mode&gt;</span>
     <span class="nt">&lt;submitType&gt;</span>json<span class="nt">&lt;/submitType&gt;</span>
     <span class="nt">&lt;showCaption&gt;</span>true<span class="nt">&lt;/showCaption&gt;</span>
     <span class="nt">&lt;showCancelButton&gt;</span>true<span class="nt">&lt;/showCancelButton&gt;</span>
     <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/component&gt;</span>
  <span class="nt">&lt;/components&gt;</span>
<span class="nt">&lt;/template-instance&gt;</span>
</code></pre></div><h2 id="3-surf-component">3. Surf component</h2>
<p>In the <code>config/web-extension/site-webscripts/org/alfresco/components/alpaca-forms/</code> directory, these files describe the component referred to by the template:</p>
<ul>
<li><code>alpaca-form.get.desc.xml</code></li>
<li><code>alpaca-form.get.head.ftl</code></li>
<li><code>alpaca-form.get.html.ftl</code></li>
<li><code>alpaca-form.get.properties</code></li>
</ul>
<p>Together, they render the necessary script and CSS tags to include the Alpaca library on the page, and pull in the custom JavaScript files that communicate with Alfresco. The magic happens in <code>alpaca-form.get.html.ftl</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;alpaca-form-field&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;alpaca-form-field-button-bar&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="nx">Alpaca</span><span class="p">.</span><span class="nx">Forms</span><span class="p">.</span><span class="nx">Product</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span><span class="s2">&#34;${(page.url.args.nodeRef!&#34;&#34;)?js_string}&#34;</span><span class="p">);</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div><p>The initialize function passes the node reference to the code that will query Alfresco for the JSON object and pass it to Alpaca. Alpaca will then attach itself to the &ldquo;alpaca-form-field&rdquo; div element and&ndash;voila!&ndash;instant form goodness.</p>
<hr>
<p>Diving into the Alpaca specifics a bit more, you can see the request and rendering occurring in web/alpaca/js_src/AlpacaForms.js. This file is included as part of the Surf component and sets up a namespace and defines the function we&rsquo;ll use to invoke Alfresco and do some housekeeping. The initialize function retrieves the content from Alfresco with a jQuery AJAX call and then passes it to Alpaca.</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="nx">url</span> <span class="o">:</span> <span class="s2">&#34;/share/proxy/alfresco/api/node/content/&#34;</span>
    <span class="o">+</span> <span class="nx">storeType</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="nx">storeId</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span>
    <span class="o">+</span> <span class="nx">nodeId</span><span class="p">,</span>
  <span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&#34;#alpaca-form-field&#34;</span><span class="p">).</span><span class="nx">alpaca</span><span class="p">({</span>
     <span class="s2">&#34;data&#34;</span> <span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
     <span class="s2">&#34;schema&#34;</span> <span class="o">:</span> <span class="nx">Alpaca</span><span class="p">.</span><span class="nx">Forms</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">Product</span><span class="p">,</span>
     <span class="s2">&#34;options&#34;</span> <span class="o">:</span> <span class="nx">Alpaca</span><span class="p">.</span><span class="nx">Forms</span><span class="p">.</span><span class="nx">Options</span><span class="p">.</span><span class="nx">Product</span><span class="p">,</span>
     <span class="p">...</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="p">...</span>
<span class="p">});</span>
</code></pre></div><p>We also provide Alpaca with a description of the JSON object it will be receiving. This description is broken into two pieces: the &ldquo;schema&rdquo; and &ldquo;options&rdquo;. The schema describes the JSON object and its properties. The options describe how those properties will be rendered as form components. In the demo project, we are using the example of a piece of JSON describing a product called &ldquo;moxie.json&rdquo;:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;product&#34;</span> <span class="p">:</span> <span class="s2">&#34;Moxie&#34;</span><span class="p">,</span>
  <span class="nt">&#34;description&#34;</span> <span class="p">:</span> <span class="s2">&#34;Lorem ipsum dolor sit amet, consectetur adipiscing elit...&#34;</span><span class="p">,</span>
  <span class="nt">&#34;release-date&#34;</span> <span class="p">:</span> <span class="s2">&#34;06/22/2012&#34;</span><span class="p">,</span>
  <span class="nt">&#34;archived&#34;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nt">&#34;version&#34;</span> <span class="p">:</span> <span class="s2">&#34;1.0&#34;</span><span class="p">,</span>
  <span class="nt">&#34;subject&#34;</span> <span class="p">:</span> <span class="s2">&#34;Reading&#34;</span>  
<span class="p">}</span>
</code></pre></div><p>Alpaca is configured with a schema that describes this structure in <code>web/alpaca/js_src/schema/ProductSchema.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">Alpaca</span><span class="p">.</span><span class="nx">Forms</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">Product</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Product Form&#34;</span><span class="p">,</span>
  <span class="s2">&#34;description&#34;</span> <span class="o">:</span> <span class="s2">&#34;Schema for Demo Product JSON object&#34;</span><span class="p">,</span>
  <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;object&#34;</span><span class="p">,</span>
  <span class="s2">&#34;properties&#34;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&#34;product&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Name&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="s2">&#34;required&#34;</span> <span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="s2">&#34;description&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Description&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="s2">&#34;required&#34;</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="s2">&#34;release-date&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Release Date&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="s2">&#34;required&#34;</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="s2">&#34;archived&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Archived?&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;boolean&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;version&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Version&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="s2">&#34;required&#34;</span> <span class="o">:</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="s2">&#34;subject&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;title&#34;</span> <span class="o">:</span> <span class="s2">&#34;Subject&#34;</span><span class="p">,</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
      <span class="s2">&#34;required&#34;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">&#34;enum&#34;</span> <span class="o">:</span> <span class="p">[</span>
          <span class="s2">&#34;Arithmetic&#34;</span><span class="p">,</span>
          <span class="s2">&#34;English&#34;</span><span class="p">,</span>
          <span class="s2">&#34;French&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Geography&#34;</span><span class="p">,</span>
          <span class="s2">&#34;German&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Reading&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Spanish&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Writing&#34;</span>
      <span class="p">],</span>
      <span class="s2">&#34;default&#34;</span> <span class="o">:</span> <span class="s2">&#34;Reading&#34;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div><p>Next, the options describe the form fields that Alpaca should render for each property:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">Alpaca</span><span class="p">.</span><span class="nx">Forms</span><span class="p">.</span><span class="nx">Options</span><span class="p">.</span><span class="nx">Product</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&#34;label&#34;</span> <span class="o">:</span> <span class="s2">&#34;Product Form&#34;</span><span class="p">,</span>
  <span class="s2">&#34;helper&#34;</span> <span class="o">:</span> <span class="s2">&#34;Enter the product data.&#34;</span><span class="p">,</span>
  <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;alpaca.demo.product&#34;</span><span class="p">,</span>
  <span class="s2">&#34;fields&#34;</span> <span class="o">:</span> <span class="p">{</span>
    <span class="s2">&#34;product&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;text&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;description&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;textarea&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;release-date&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;date&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;archived&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;checkbox&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;version&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;text&#34;</span>
    <span class="p">},</span>
    <span class="s2">&#34;subject&#34;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&#34;type&#34;</span> <span class="o">:</span> <span class="s2">&#34;select&#34;</span><span class="p">,</span>
      <span class="s2">&#34;optionLabels&#34;</span> <span class="o">:</span> <span class="p">[</span>
        <span class="s2">&#34;Arithmetic&#34;</span><span class="p">,</span>
        <span class="s2">&#34;English&#34;</span><span class="p">,</span>
        <span class="s2">&#34;French&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Geography&#34;</span><span class="p">,</span>
        <span class="s2">&#34;German&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Reading&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Spanish&#34;</span><span class="p">,</span>
        <span class="s2">&#34;Writing&#34;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div><p>Once Alpaca has these descriptions and the JSON object itself, the form can be rendered.</p>
<p>To access the form, we configured an action link that is visible on the node from the document library. This action passes the document&rsquo;s node reference to the custom page, which then passes it to the JavaScript function. We don&rsquo;t necessarily want the new page to be accessible for any piece of content, so we restricted the action based on content type. This can be seen in the file <code>config/web-extension/alpaca-action-context.xml</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE beans PUBLIC &#39;-//SPRING/DTD BEAN//EN&#39; &#39;http://www.springframework.org/dtd/spring-beans.dtd&#39;&gt;</span>
<span class="nt">&lt;beans&gt;</span>
  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;evaluator.doclib.action.edit-alpaca&#34;</span> <span class="na">parent=</span><span class="s">&#34;evaluator.doclib.action.isMimetype&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;mimetypes&#34;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;list&gt;</span>
        <span class="nt">&lt;value&gt;</span>application/json<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><p>The action is then configured in <code>share-config-custom.xml</code> using the above evaluator to control visibility:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;alfresco-config&gt;</span>
  <span class="nt">&lt;config</span> <span class="na">evaluator=</span><span class="s">&#34;string-compare&#34;</span> <span class="na">condition=</span><span class="s">&#34;DocLibActions&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;actions&gt;</span>
      <span class="nt">&lt;action</span> <span class="na">id=</span><span class="s">&#34;document-edit-alpaca&#34;</span> <span class="na">type=</span><span class="s">&#34;pagelink&#34;</span> <span class="na">label=</span><span class="s">&#34;actions.document.edit-alpaca&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&#34;page&#34;</span><span class="nt">&gt;</span>edit-alpaca?nodeRef={node.nodeRef}<span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;permissions&gt;</span>
          <span class="nt">&lt;permission</span> <span class="na">allow=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>Write<span class="nt">&lt;/permission&gt;</span>
        <span class="nt">&lt;/permissions&gt;</span>
        <span class="nt">&lt;evaluator</span> <span class="na">negate=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>evaluator.doclib.action.isLocked<span class="nt">&lt;/evaluator&gt;</span>
        <span class="nt">&lt;evaluator&gt;</span>evaluator.doclib.action.edit-alpaca<span class="nt">&lt;/evaluator&gt;</span>
      <span class="nt">&lt;/action&gt;</span>
    <span class="nt">&lt;/actions&gt;</span>
    <span class="nt">&lt;actionGroups&gt;</span>
      <span class="nt">&lt;actionGroup</span> <span class="na">id=</span><span class="s">&#34;document-browse&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">index=</span><span class="s">&#34;100&#34;</span> <span class="na">id=</span><span class="s">&#34;document-edit-alpaca&#34;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/actionGroup&gt;</span>
      <span class="nt">&lt;actionGroup</span> <span class="na">id=</span><span class="s">&#34;document-details&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">index=</span><span class="s">&#34;100&#34;</span> <span class="na">id=</span><span class="s">&#34;document-edit-alpaca&#34;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/actionGroup&gt;</span>
    <span class="nt">&lt;/actionGroups&gt;</span>
  <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/alfresco-config&gt;</span>
</code></pre></div><p>Finally, leveraging Alfresco&rsquo;s webscripting capabilities, we built HTTP endpoints that send and receive node content in JSON format. In the demo project, I&rsquo;ve assumed that the node content is already JSON (with a mimetype of &ldquo;application/json&rdquo;) and because of this I can point the custom code to the out-of-the-box content retrieval webscript at <code>/api/node/content</code>. As a side note, we converted our customer&rsquo;s XML content to JSON in this webscript.</p>
<p>The webscript to store the new JSON object takes a node reference and simply stores the JSON directly to the content of the node. Take a look at the webscript files located at <code>demo-alpaca-repo/config/alfresco/extension/templates/webscripts/com/tribloom/demo/product/product.post.json.js</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">model</span><span class="p">.</span><span class="nx">success</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">nodeRef</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">templateArgs</span><span class="p">[</span><span class="s1">&#39;storeType&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;://&#34;</span> 
        <span class="o">+</span> <span class="nx">url</span><span class="p">.</span><span class="nx">templateArgs</span><span class="p">[</span><span class="s1">&#39;storeId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> 
        <span class="o">+</span> <span class="nx">url</span><span class="p">.</span><span class="nx">templateArgs</span><span class="p">[</span><span class="s1">&#39;nodeId&#39;</span><span class="p">];</span>

  <span class="kd">var</span> <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nx">search</span><span class="p">.</span><span class="nx">findNode</span><span class="p">(</span><span class="nx">nodeRef</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">scriptNode</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">status</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
    <span class="nx">status</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="s2">&#34;Unable to find node for nodeRef &#34;</span> <span class="o">+</span> <span class="nx">nodeRef</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">json</span><span class="p">;</span>

  <span class="nx">model</span><span class="p">.</span><span class="nx">success</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">model</span><span class="p">.</span><span class="nx">nodeRef</span> <span class="o">=</span> <span class="nx">nodeRef</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">main</span><span class="p">();</span>
</code></pre></div><p>These three customizations are common changes that illustrate how simple it is to extend Share &ndash; particularly with the improvements to 4.0 that provide extension points in the XML configuration files.</p>
<p>By using the Alpaca library as an example, I hope I&rsquo;ve demonstrated this and shown that Alpaca is an easily integrated library that gives you forms capabilities with minimal development.</p>

        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://hakuna-automata.com/posts/counters-in-alfresco/" data-toggle="tooltip" data-placement="top" title="Counters in Alfresco">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://hakuna-automata.com/posts/mysql-commands-in-bash/" data-toggle="tooltip" data-placement="top" title="MySQL Commands in Bash Scripts">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2018
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://hakuna-automata.com/">Hakuna Automata</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.72.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://hakuna-automata.com/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://hakuna-automata.com/js/load-photoswipe.js"></script>









    
  </body>
</html>

